From 25ed7a6aebd7bd970665794472462af8141e754c Mon Sep 17 00:00:00 2001
From: Zhenyu Liang <zhenyu.liang@intel.com>
Date: Fri, 15 Dec 2017 04:13:58 +0800
Subject: [PATCH] Fix host-only build failure

Change-Id: I1c3eefe3301871af850ec043e0629b83aed2f8f7
Tracked-On:
---
 mk_yunos.sh                                  | 5 +++++
 platform/tablet/product/yunhal/xmake.product | 8 +++++++-
 prebuilts/devtools/mk-image.sh               | 2 +-
 3 files changed, 13 insertions(+), 2 deletions(-)

diff --git a/mk_yunos.sh b/mk_yunos.sh
index ebc3305..02e9a9d 100755
--- a/mk_yunos.sh
+++ b/mk_yunos.sh
@@ -220,6 +220,11 @@ else
         ;;
     tablet)
         BUILD_BOARD="intel"
+        moreArgs="$moreArgs --with-arch-target=x86 --with-toolchainname=i686-linux-gnu"
+        case $BUILD_PRODUCT in
+            yunhal|yunbot)
+                moreArgs="$moreArgs --with-hal=yunos --enable-cntr-hal=no --enable-cntr-cvg=no --enable-cntr-rt=no --with-container=no --enable-hostonlyos";;
+        esac
         ;;
   esac
   if [ -z "$BUILD_BOARD" ]; then # still couldn't match to the board
diff --git a/platform/tablet/product/yunhal/xmake.product b/platform/tablet/product/yunhal/xmake.product
index cef3736..11d3b19 100644
--- a/platform/tablet/product/yunhal/xmake.product
+++ b/platform/tablet/product/yunhal/xmake.product
@@ -325,7 +325,9 @@
     wpa_supplicant \
     libnl1 \
     e2fsprogs \
-    ipsec-tools
+    ipsec-tools \
+    woogeen_bin \
+    woogeen_jsni
 
 # note this tool must have Microsoft authorized license
 # ntfs-3g link: http://www.tuxera.com/community/open-source-ntfs-3g/
@@ -460,3 +462,7 @@
     connectivitybridge
 --fi
 
+--if [[XMAKE_ENABLE_CLOSED_SOURCE]] == true
+--pkgs-excluded \
+     butler-js calculator-js calendar-js fota-js gallery-js keyguard-js notes-js recorder-js settingsprovider-js systemres-js account-js tablet-appstore-js tablet-audioplayer-js tablet-cloudsync-js tablet-edudesk-js tablet-filemanager-js tablet-omadm-js tablet-texteditor-js tablet-vepservice-js tablet-videoplayer-js libasec qt5 qt5-qtdeclarative system-fonts yunos-fonts datasensoring datasensoring-api django libkeyguardserviceproxy mobilecloudservice permission signature accountmanagerd charged cmns djangod locationservice permd propertyd searchd secd urlflt-proxy syncmanagerd tksd usertrackd uuid account-core agil-js agil-lib caf-js caf2 inputmanager node_caf_image node_caf_matrix node_cmns gateway node_omadm node-search sync
+--fi
diff --git a/prebuilts/devtools/mk-image.sh b/prebuilts/devtools/mk-image.sh
index 99a3e6c..2c788fb 100755
--- a/prebuilts/devtools/mk-image.sh
+++ b/prebuilts/devtools/mk-image.sh
@@ -706,7 +706,7 @@ make_intel_yunhal_image()
     ln -s /mnt/data/yunos/share ${XMAKE_ROOTFS_DIR}/data
     cp -rf ${XMAKE_TOOLS_DIR}/resolv.conf ${XMAKE_ROOTFS_DIR}/etc/
 
-    if [ x"${XMAKE_BUILD_TYPE}" = x"eng" ] ; then
+    if [ x"${XMAKE_BUILD_TYPE}" = x"eng" -a "$XMAKE_ENABLE_CNTR_CVG" = "true" ] ; then
         # make android image content for test
         cp ${TOP}/prebuilts/yunos3.0/system/ramdisk.img $image_dir/ramdisk.img
         RET=$?
-- 
1.9.1

