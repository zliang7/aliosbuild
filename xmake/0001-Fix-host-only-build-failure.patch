From 3e62b2a24828de8325a510ca4fbdc896bbc7dd8f Mon Sep 17 00:00:00 2001
From: Zhenyu Liang <zhenyu.liang@intel.com>
Date: Fri, 15 Dec 2017 04:17:15 +0800
Subject: [PATCH] Fix host-only build failure

Change-Id: Iab322d191a5873b102d1380bd9ee42422745e1fb
Tracked-On:
---
 mk_yunos.sh                    | 5 +++++
 prebuilts/devtools/mk-image.sh | 2 +-
 2 files changed, 6 insertions(+), 1 deletion(-)

diff --git a/mk_yunos.sh b/mk_yunos.sh
index ebc3305..02e9a9d 100755
--- a/mk_yunos.sh
+++ b/mk_yunos.sh
@@ -220,6 +220,11 @@ else
         ;;
     tablet)
         BUILD_BOARD="intel"
+        moreArgs="$moreArgs --with-arch-target=x86 --with-toolchainname=i686-linux-gnu"
+        case $BUILD_PRODUCT in
+            yunhal|yunbot)
+                moreArgs="$moreArgs --with-hal=yunos --enable-cntr-hal=no --enable-cntr-cvg=no --enable-cntr-rt=no --with-container=no --enable-hostonlyos";;
+        esac
         ;;
   esac
   if [ -z "$BUILD_BOARD" ]; then # still couldn't match to the board
diff --git a/prebuilts/devtools/mk-image.sh b/prebuilts/devtools/mk-image.sh
index 99a3e6c..2c788fb 100755
--- a/prebuilts/devtools/mk-image.sh
+++ b/prebuilts/devtools/mk-image.sh
@@ -706,7 +706,7 @@ make_intel_yunhal_image()
     ln -s /mnt/data/yunos/share ${XMAKE_ROOTFS_DIR}/data
     cp -rf ${XMAKE_TOOLS_DIR}/resolv.conf ${XMAKE_ROOTFS_DIR}/etc/
 
-    if [ x"${XMAKE_BUILD_TYPE}" = x"eng" ] ; then
+    if [ x"${XMAKE_BUILD_TYPE}" = x"eng" -a "$XMAKE_ENABLE_CNTR_CVG" = "true" ] ; then
         # make android image content for test
         cp ${TOP}/prebuilts/yunos3.0/system/ramdisk.img $image_dir/ramdisk.img
         RET=$?
-- 
1.9.1

